{% extends 'base.html' %}
{% block title %}Facturas{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold mb-4">Facturas</h1>
<form method="get" class="mb-4 flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0 max-w-4xl mx-auto">
  <input name="q" value="{{ q or '' }}" placeholder="Buscar..." class="input flex-1">
  <button class="btn-secondary">Buscar</button>
</form>
<div class="card overflow-x-auto max-w-4xl mx-auto">
  {% if invoices %}
  <table class="min-w-full text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="p-2 text-left">ID</th>
        <th class="p-2 text-left">NCF</th>
        <th class="p-2 text-left">Cliente</th>
        <th class="p-2 text-left">Fecha</th>
        <th class="p-2 text-left">Total</th>
        <th class="p-2 text-left">Estado</th>
        <th class="p-2 text-left">Acciones</th>
      </tr>
    </thead>
    <tbody>
    {% for f in invoices %}
      <tr class="border-t">
        <td class="p-2">{{ f.id }}</td>
        <td class="p-2">{{ f.ncf }}</td>
        <td class="p-2">{{ f.client.name }}</td>
        <td class="p-2">{{ f.date.strftime('%d/%m/%Y %I:%M %p') }}</td>
        <td class="p-2">{{ f.total | money }}</td>
        <td class="p-2">{{ f.status }}</td>
        <td class="p-2 space-x-2">
          {% if f.status != 'Pagada' %}
          <form method="post" action="{{ url_for('pay_invoice', invoice_id=f.id) }}" class="inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="text-green-600 text-sm" onclick="return confirm('Â¿Marcar como pagada?')">Pagada</button>
          </form>
          {% endif %}
          <a class="text-blue-500 text-sm" href="{{ url_for('invoice_pdf', invoice_id=f.id) }}">PDF</a>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="p-2">No se encontraron resultados.</p>
  {% endif %}
</div>
{% endblock %}
